CREATE DATABASE BookStoreDB;
GO

USE BookStoreDB;
GO

CREATE TABLE Cart (
id INT PRIMARY KEY,
maKH INT,
ma_sach INT,
gia DECIMAL(10, 2),
sl INT,
tongtien DECIMAL(10, 2)
);

CREATE TABLE DONDATHANG (
MaDonHang INT PRIMARY KEY,
Ngaydat DATE,
Ngaygiao DATE,
Tinhtranggiaohang NVARCHAR(50),
maKH INT
);

CREATE TABLE CHITIETDONDATHANG (
MaDonHang INT,
Masach INT,
Soluong INT,
PRIMARY KEY (MaDonHang, Masach)
);

CREATE TABLE KHACHHANG (
MaKH INT PRIMARY KEY,
HoTen NVARCHAR(100),
Taikhoan NVARCHAR(50),
Matkhau NVARCHAR(50),
Email NVARCHAR(100),
DiachiKH NVARCHAR(200),
DienthoaiKH NVARCHAR(20),
Ngaysinh DATE,
idQuyen INT
);

CREATE TABLE Roles (
id INT PRIMARY KEY,
TenQuyen NVARCHAR(50)
);

CREATE TABLE VIETSAC (
MaTG INT,
Masach INT,
Vaitro NVARCHAR(50),
Vitri NVARCHAR(50),
PRIMARY KEY (MaTG, Masach)
);

CREATE TABLE SACH (
Masach INT PRIMARY KEY,
Tensach NVARCHAR(100),
Giaban DECIMAL(10, 2),
Mota NVARCHAR(500),
Anhbia NVARCHAR(200),
Ngaycapnhat DATE,
Soluongton INT,
MaCD INT,
MaNXB INT
);

CREATE TABLE NHAXUATBAN (
MaNXB INT PRIMARY KEY,
TenNXB NVARCHAR(100),
Diachi NVARCHAR(200),
Dienthoai NVARCHAR(20)
);

CREATE TABLE TACGIA (
MaTG INT PRIMARY KEY,
TenTG NVARCHAR(100),
Diachi NVARCHAR(200),
Tieusu NVARCHAR(500),
Dienthoai NVARCHAR(20)
);

CREATE TABLE CHUDE (
MaCD INT PRIMARY KEY,
TenChuDe NVARCHAR(100)
);

-- Khóa Ngoại
ALTER TABLE Cart
ADD FOREIGN KEY (maKH) REFERENCES KHACHHANG(MaKH),
ADD FOREIGN KEY (ma_sach) REFERENCES SACH(Masach);

ALTER TABLE DONDATHANG
ADD FOREIGN KEY (maKH) REFERENCES KHACHHANG(MaKH);

ALTER TABLE CHITIETDONDATHANG
ADD FOREIGN KEY (MaDonHang) REFERENCES DONDATHANG(MaDonHang),
ADD FOREIGN KEY (Masach) REFERENCES SACH(Masach);

ALTER TABLE KHACHHANG
ADD FOREIGN KEY (idQuyen) REFERENCES Roles(id);

ALTER TABLE VIETSAC
ADD FOREIGN KEY (MaTG) REFERENCES TACGIA(MaTG),
ADD FOREIGN KEY (Masach) REFERENCES SACH(Masach);

ALTER TABLE SACH
ADD FOREIGN KEY (MaCD) REFERENCES CHUDE(MaCD),
ADD FOREIGN KEY (MaNXB) REFERENCES NHAXUATBAN(MaNXB);